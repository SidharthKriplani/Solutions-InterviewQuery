https://www.interviewquery.com/questions/identifying-user-sessions

SQL:

WITH cte AS 
(SELECT ID, CREATED_AT, USER_ID, EVENT, 
COALESCE(TIMESTAMPDIFF(SECOND, LAG(CREATED_AT) OVER(ORDER BY CREATED_AT), CREATED_AT)/60, 0) LAGGED
FROM EVENTS), 

FILTER_LAYER_1 AS 
(SELECT ID, CREATED_AT, USER_ID, LAGGED, EVENT,  
CASE WHEN LAGGED > 60 THEN LAGGED-LAGGED ELSE LAGGED END AS IND
FROM CTE)

SELECT CREATED_AT, USER_ID, EVENT, DENSE_RANK() OVER(PARTITION BY IND) SESSION_ID 
FROM FILTER_LAYER_1


PYTHON:

