https://www.interviewquery.com/questions/rolling-average-steps

SQL:

WITH CTE AS 
(
    SELECT 
    ID, USER_ID, STEPS, 
    LAG(DATE, 1, '1970-01-01') OVER(PARTITION BY USER_ID ORDER BY DATE ASC) AS PREVIOUS_DATE, DATE, 
    DATE - LAG(DATE, 1, '1970-01-01') OVER(PARTITION BY USER_ID ORDER BY DATE ASC) AS DIFF
    FROM DAILY_STEPS
),

FIRST_LAYER AS 
(
    SELECT 
    USER_ID, 
    DATE, 
    STEPS, 
    LAG(STEPS, 1, 0) OVER(PARTITION BY USER_ID ORDER BY DATE) AS STEPS_1_DAY_BACK, 
    LAG(STEPS, 2, 0) OVER(PARTITION BY USER_ID ORDER BY DATE) AS STEPS_2_DAYS_BACK
    FROM 
    (SELECT ID, USER_ID, STEPS, DATE FROM CTE WHERE DIFF < 2) A
)

SELECT 
USER_ID, DATE, 
ROUND((STEPS + STEPS_1_DAY_BACK + STEPS_2_DAYS_BACK)/3.0, 0) AS AVG_STEPS
FROM FIRST_LAYER
WHERE STEPS_1_DAY_BACK != 0 AND STEPS_2_DAYS_BACK != 0


PYTHON:

