https://www.interviewquery.com/questions/cumulative-sales-since-last-restocking

SQL:

WITH CTE AS 
(SELECT 
P.PRODUCT_ID, P.PRODUCT_NAME, 
S.SALES_ID, S.DATE AS SALES_DATE, S.SOLD_COUNT AS SOLD_COUNT, 
R.RESTOCK_ID AS RESTOCK_ID, R.RESTOCK_DATE AS RESTOCK_DATE
FROM PRODUCTS P 
JOIN SALES S ON P.PRODUCT_ID = S.PRODUCT_ID
JOIN RESTOCKING R ON R.PRODUCT_ID = P.PRODUCT_ID), 

LAST_RESTOCKING_DATE AS 
(
SELECT PRODUCT_NAME, MAX(RESTOCK_DATE) AS RESTOCK_DATE
FROM CTE 
GROUP BY 1 
)

SELECT
CTE.PRODUCT_NAME, CTE.SALES_DATE AS DATE, 
SUM(CTE.SOLD_COUNT) OVER(PARTITION BY CTE.PRODUCT_NAME ORDER BY CTE.SALES_DATE) AS SALES_SINCE_LAST_RESTOCK
FROM LAST_RESTOCKING_DATE LRD 
LEFT JOIN CTE ON 
LRD.RESTOCK_DATE = CTE.RESTOCK_DATE AND 
LRD.PRODUCT_NAME = CTE.PRODUCT_NAME 
WHERE CTE.SALES_DATE >= LRD.RESTOCK_DATE


PYTHON:
